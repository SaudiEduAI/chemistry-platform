<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ù…Ù†ØµÙ‘Ø© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ 2-2 Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&display=swap" rel="stylesheet">

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      /* Ø£Ù„ÙˆØ§Ù† Ø¹Ù„Ù…ÙŠØ© (Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ) */
      --p1:#33618C;  /* Ø£Ø²Ø±Ù‚ */
      --p2:#4B8B67;  /* Ø£Ø®Ø¶Ø± */
      --p3:#CF883D;  /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ/Ø°Ù‡Ø¨ÙŠ */
      --bg:#F8F9FA;  /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */

      --ink:#1f2a37;
      --muted:#6b7280;
      --card:rgba(255,255,255,.88);
      --stroke:rgba(31,42,55,.08);
      --shadow: 0 18px 55px rgba(31,42,55,.12);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 12% 10%, rgba(51,97,140,.18), transparent 60%),
        radial-gradient(900px 650px at 92% 18%, rgba(75,139,103,.16), transparent 55%),
        radial-gradient(850px 650px at 45% 92%, rgba(207,136,61,.14), transparent 55%),
        linear-gradient(135deg, #ffffff, var(--bg));
      min-height:100vh;
      background-size: 200% 200%, 180% 180%, 180% 180%, 100% 100%;
      animation: bgFlow 14s ease-in-out infinite;
    }
    @keyframes bgFlow {
      0% { background-position: 0% 50%, 100% 20%, 40% 90%, 0% 0%; }
      50%{ background-position: 100% 50%, 0% 20%, 60% 80%, 100% 100%; }
      100%{ background-position: 0% 50%, 100% 20%, 40% 90%, 0% 0%; }
    }

    .wrap{max-width:1120px;margin:0 auto;padding:18px 14px 90px}
    header{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      padding:16px 16px 12px;
      background:var(--card);border:1px solid rgba(255,255,255,.9);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand h1{margin:0;font-size:20px;font-weight:900}
    .brand p{margin:6px 0 0;color:var(--muted);font-size:13px;font-weight:800}

    .pill{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .badge{
      padding:8px 12px;border-radius:999px;font-size:13px;font-weight:900;
      border:1px solid rgba(255,255,255,.75);
      background:linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.60));
    }
    .badge b{color:var(--p1)}

    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    button{
      border:0;cursor:pointer;
      padding:10px 14px;border-radius:14px;
      font-weight:900;
      background:linear-gradient(135deg, var(--p2), var(--p1));
      color:white;
      box-shadow:0 10px 25px rgba(51,97,140,.18);
      transition:transform .08s ease, filter .12s ease;
    }
    button:active{transform:translateY(1px) scale(.99)}
    .ghost{
      background:linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.65));
      color:var(--ink);
      border:1px solid rgba(255,255,255,.95);
      box-shadow:none;
    }

    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‡ÙˆÙŠØ© */
    .identity{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .identity .field{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.90);
      border:1px solid var(--stroke);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    }
    .identity label{
      font-weight:950;
      font-size:13px;
      color:var(--muted);
      white-space:nowrap;
    }
    .identity input{
      border:0;
      outline:0;
      background:transparent;
      font-family:inherit;
      font-weight:950;
      font-size:14px;
      min-width:140px;
      color:var(--ink);
    }
    .identity input::placeholder{
      color:#9ca3af;
      font-weight:800;
    }

    main{margin-top:14px;display:grid;gap:14px}
    .pageCard{
      background:var(--card);
      border:1px solid rgba(255,255,255,.9);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      padding:14px;
    }
    .topbar{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-bottom:10px;
    }
    .crumb{color:var(--muted);font-weight:950}
    .nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .nav .mini{padding:8px 12px;border-radius:14px;font-weight:900}

    .intro{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-bottom:10px;
    }
    .intro h2{margin:0;font-size:18px;font-weight:950}
    .intro small{color:var(--muted);font-weight:850}

    .progress{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      color:var(--muted);font-weight:950;
    }
    .bar{
      width:200px;height:10px;border-radius:999px;background:rgba(31,42,55,.08);overflow:hidden;
    }
    .bar > i{
      display:block;height:100%;width:0%;
      background:linear-gradient(90deg, var(--p2), var(--p1), var(--p3));
      border-radius:999px;
    }

    .timerPill{
      padding:8px 12px;border-radius:999px;
      background:rgba(255,255,255,.90);
      border:1px solid var(--stroke);
      font-weight:950;color:var(--muted);
      display:flex;gap:8px;align-items:center;
    }
    .timerPill b{color:var(--p1)}
    .timerPill.danger{
      border-color: rgba(207,136,61,.35);
      background: linear-gradient(135deg, rgba(207,136,61,.10), rgba(255,255,255,.88));
    }
    .timerPill.ok{
      border-color: rgba(75,139,103,.35);
      background: linear-gradient(135deg, rgba(75,139,103,.10), rgba(255,255,255,.88));
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© */
    .board{display:grid;gap:12px;grid-template-columns: 1fr;}
    @media (min-width: 860px){ .board{grid-template-columns: 1fr 1fr;} }

    .col{
      background:rgba(255,255,255,.90);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
    }
    .col h3{
      margin:0 0 10px;
      font-size:15px;font-weight:950;
      display:flex;justify-content:space-between;align-items:center;
    }
    .col h3 span{font-size:12px;color:var(--muted);font-weight:900}

    .list{display:grid;gap:10px}
    .item{
      padding:12px 12px;border-radius:16px;
      border:1px solid rgba(31,42,55,.10);
      background:linear-gradient(135deg, rgba(51,97,140,.08), rgba(75,139,103,.06));
      font-weight:950;
      cursor:pointer;
      user-select:none;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      transition:transform .08s ease, filter .12s ease;
    }
    .item:active{transform:translateY(1px)}
    .item small{color:var(--muted);font-weight:900}
    .item.selected{
      outline:3px solid rgba(75,139,103,.45);
      background:linear-gradient(135deg, rgba(75,139,103,.16), rgba(255,255,255,.92));
    }
    .item.matched{
      cursor:default;
      opacity:.78;
      background:linear-gradient(135deg, rgba(75,139,103,.16), rgba(255,255,255,.92));
      border-color: rgba(75,139,103,.55);
    }
    .item.wrong{
      animation: shake .22s ease-in-out 0s 1;
      outline:3px solid rgba(207,136,61,.45);
      background:linear-gradient(135deg, rgba(207,136,61,.14), rgba(255,255,255,.92));
    }
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(6px)}
      50%{transform:translateX(-6px)}
      75%{transform:translateX(4px)}
      100%{transform:translateX(0)}
    }

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-weight:900;
      line-height:1.8;
    }

    .footerRow{
      margin-top:12px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      padding:8px 12px;border-radius:999px;
      background:rgba(255,255,255,.88);
      border:1px solid var(--stroke);
      font-weight:950;
      color:var(--muted);
    }

    .pages{display:none;}
    .pages.active{display:block}

    /* Toast */
    .toast{
      position:fixed;
      left:16px;
      bottom:16px;
      z-index:9999;
      max-width:min(420px, calc(100vw - 32px));
      background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      border:1px solid rgba(255,255,255,.95);
      box-shadow:0 18px 55px rgba(31,42,55,.14);
      border-radius:18px;
      padding:12px 14px;
      font-weight:950;
      display:none;
      backdrop-filter: blur(10px);
    }
    .toast.show{display:block; animation: pop .18s ease-out;}
    @keyframes pop{from{transform:translateY(10px);opacity:.0}to{transform:translateY(0);opacity:1}}

    /* Reward Overlay */
    .rewardOverlay{
      position:fixed; inset:0;
      background:rgba(17,24,39,.42);
      z-index:9998;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .rewardOverlay.show{display:flex}
    .rewardCard{
      position:relative;
      overflow:hidden;
      width:min(560px, 96vw);
      background:linear-gradient(135deg, rgba(255,255,255,.94), rgba(255,255,255,.78));
      border:1px solid rgba(255,255,255,.92);
      box-shadow:0 22px 70px rgba(31,42,55,.22);
      border-radius:24px;
      padding:16px;
      backdrop-filter: blur(12px);
      text-align:center;
    }
    .rewardCard::before{
      content:"";
      position:absolute;
      inset:-60px;
      background:
        radial-gradient(circle at 20% 20%, rgba(51,97,140,.18), transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(75,139,103,.16), transparent 45%),
        radial-gradient(circle at 50% 80%, rgba(207,136,61,.14), transparent 50%);
      filter: blur(2px);
      opacity:.95;
      pointer-events:none;
    }
    .rewardCard::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,0));
      pointer-events:none;
    }
    .rewardTitle{
      margin:0;
      font-size:20px;
      font-weight:980;
      letter-spacing:.2px;
      position:relative;
      z-index:1;
    }
    .rewardMedal{
      font-size:64px;
      margin:10px 0 6px;
      filter: drop-shadow(0 10px 22px rgba(51,97,140,.18));
      position:relative;
      z-index:1;
      animation: crownBounce .9s ease-in-out infinite;
    }
    @keyframes crownBounce{
      0%,100%{ transform: translateY(0) rotate(-2deg); }
      50%{ transform: translateY(-6px) rotate(2deg); }
    }
    .rewardText{
      margin:0;
      color:var(--muted);
      font-weight:900;
      line-height:1.85;
      position:relative;
      z-index:1;
    }
    .rewardRow{
      margin-top:12px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      position:relative;
      z-index:1;
    }
    #rewardNext{
      box-shadow: 0 12px 28px rgba(207,136,61,.20);
    }

    /* Sparkles */
    .sparkles{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:0;
    }
    .sparkles i{
      position:absolute;
      width:10px;height:10px;
      background: radial-gradient(circle, rgba(255,255,255,.95), rgba(255,255,255,0) 70%);
      border-radius:50%;
      opacity:.0;
      animation: twinkle 1.8s ease-in-out infinite;
    }
    @keyframes twinkle{
      0%{ transform: scale(.6); opacity:0; }
      35%{ opacity:.95; }
      70%{ transform: scale(1.35); opacity:.2; }
      100%{ opacity:0; }
    }

    /* Trophy ribbon tags */
    .trophyRibbon{
      display:flex;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .trophyRibbon .tag{
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.88);
      border:1px solid var(--stroke);
      font-weight:950;
      color:var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Ù…Ù†ØµÙ‘Ø© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ 2-2 Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h1>
        <p>ØªØ¹Ù„Ù‘Ù… â€“ Ø·Ø¨Ù‘Ù‚ â€“ ÙØ±Ù‘Ù‚ â€¢ Ù„Ø¹Ø¨Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± (Tap-to-Match)</p>
      </div>

      <div class="identity">
        <div class="field">
          <label>ğŸ« Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
          <input id="schoolName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
        </div>
        <div class="field">
          <label>âœï¸ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</label>
          <input id="teacherName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©">
        </div>
        <div class="field">
          <label>ğŸ« Ø§Ù„Ù…Ø¯ÙŠØ±Ø©</label>
          <input id="principalName" type="text" placeholder="Ø§Ø³Ù… Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
        </div>
      </div>

      <div class="pill">
        <div class="badge">Ø§Ù„Ù†Ù‚Ø§Ø·: <b id="score">0</b> â­</div>
        <div class="badge">Ø³Ù„Ø³Ù„Ø© Ù†Ø¬Ø§Ø­: <b id="streak">0</b> ğŸ”¥</div>
      </div>

      <div class="actions">
        <button class="ghost" id="toggleSound">ğŸ”Š Ø§Ù„ØµÙˆØª: ØªØ´ØºÙŠÙ„</button>
        <button class="ghost" id="resetAll">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
      </div>
    </header>

    <main>
      <!-- Navigation -->
      <section class="pageCard">
        <div class="topbar">
          <div class="crumb" id="pageCrumb">Ø§Ù„ÙØµÙ„ 1/4 â€” Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©</div>
          <div class="nav">
            <button class="ghost mini" id="prevPage">â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button class="ghost mini" id="nextPage">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
          </div>
        </div>

        <div id="pagesHost"></div>
      </section>

      <section class="pageCard">
        <div class="hint">
          âœ… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨: Ø§Ø¶ØºØ·/ÙŠ Ù…ÙÙ‡ÙˆÙ…Ù‹Ø§ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ·/ÙŠ ØªØ¹Ø±ÙŠÙÙ‡ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±.  
          Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ğŸ‰ + ğŸ‘  
          Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£: Ø§Ù‡ØªØ²Ø§Ø² Ø®ÙÙŠÙ + ØªÙ†Ø¨ÙŠÙ‡.
        </div>
        <div class="footerRow">
          <div class="chips">
            <div class="chip">Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¬ÙˆØ§Ù„</div>
            <div class="chip">Ø¨Ø¯ÙˆÙ† Ø³Ø­Ø¨</div>
            <div class="chip">Ù†ØªÙŠØ¬Ø© ÙÙˆØ±ÙŠØ©</div>
          </div>
          <div class="chips">
            <div class="chip">4 ÙØµÙˆÙ„ Ø¯Ø§Ø®Ù„ Ù…Ù†ØµØ© ÙˆØ§Ø­Ø¯Ø©</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toast" id="toast">â€”</div>

  <div class="rewardOverlay" id="rewardOverlay" role="dialog" aria-modal="true">
    <div class="rewardCard">
      <div class="sparkles" id="sparkles"></div>
      <div class="rewardMedal" id="rewardIcon">ğŸ‘‘</div>
      <h3 class="rewardTitle" id="rewardTitle">Ù…Ù…ØªØ§Ø²!</h3>
      <p class="rewardText" id="rewardText">â€”</p>
      <div class="rewardRow">
        <button class="ghost" id="rewardClose">Ø¥ØºÙ„Ø§Ù‚</button>
        <button class="ghost" id="rewardRestart">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡ â†º</button>
        <button id="rewardNext">Ø§Ù„ÙØµÙ„ Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØµÙˆÙ„ (4 ØµÙØ­Ø§Øª)
   ========================= */
const PAGES = [
  {
    id: "p1",
    title: "Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©",
    subtitle: "ÙØ±Ù‘Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©",
    pairs: [
      { right: "Ø§Ù„Ù†Ø¸Ø§Ù…", left: "Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ Ù†Ø¯Ø±Ø³Ù‡ Ù…Ù† Ø§Ù„ÙƒÙˆÙ†" },
      { right: "Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ù…Ø­ÙŠØ·", left: "ÙƒÙ„ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù†Ø¸Ø§Ù…" },
      { right: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© (q)", left: "Ø§Ù†ØªÙ‚Ø§Ù„ Ø·Ø§Ù‚Ø© Ø¨Ø³Ø¨Ø¨ ÙØ±Ù‚ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©" },
      { right: "Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©", left: "Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…" },
      { right: "ØªÙØ§Ø¹Ù„ Ø·Ø§Ø±Ø¯ Ù„Ù„Ø­Ø±Ø§Ø±Ø©", left: "ÙŠØ·Ù„Ù‚ Ø­Ø±Ø§Ø±Ø© Ù„Ù„ÙˆØ³Ø· (Î”H Ø³Ø§Ù„Ø¨ ØºØ§Ù„Ø¨Ù‹Ø§)" },
      { right: "ØªÙØ§Ø¹Ù„ Ù…Ø§Øµ Ù„Ù„Ø­Ø±Ø§Ø±Ø©", left: "ÙŠÙ…ØªØµ Ø­Ø±Ø§Ø±Ø© Ù…Ù† Ø§Ù„ÙˆØ³Ø· (Î”H Ù…ÙˆØ¬Ø¨ ØºØ§Ù„Ø¨Ù‹Ø§)" },
      { right: "Î”H Ù…ÙˆØ¬Ø¨Ø©", left: "ÙŠØ¯Ù„ ØºØ§Ù„Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ ØªÙØ§Ø¹Ù„ Ù…Ø§Øµ" },
      { right: "Î”H Ø³Ø§Ù„Ø¨Ø©", left: "ÙŠØ¯Ù„ ØºØ§Ù„Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ ØªÙØ§Ø¹Ù„ Ø·Ø§Ø±Ø¯" },
      { right: "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©", left: "Ù…Ø¹Ø§Ø¯Ù„Ø© ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© Ù…Ø±ÙÙ‚Ø© Ø¨Ù‚ÙŠÙ…Ø© Î”H" },
      { right: "Ø§Ù„Ù…Ø³Ø¹Ø±", left: "Ø¬Ù‡Ø§Ø² Ù„Ù‚ÙŠØ§Ø³ ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø·Ù„Ù‚Ø©/Ø§Ù„Ù…Ù…ØªØµØ©" },
      { right: "Ù‚Ø§Ù†ÙˆÙ† Ù‡Ø³", left: "Î”H Ø§Ù„ÙƒÙ„ÙŠ = Ù…Ø¬Ù…ÙˆØ¹ Î”H Ù„Ù„Ø®Ø·ÙˆØ§Øª" },
      { right: "Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØªÙƒÙˆÙŠÙ†", left: "ØªØºÙŠØ± Ø­Ø±Ø§Ø±Ø© ØªÙƒÙˆÙŠÙ† 1 Ù…ÙˆÙ„ Ù…Ù† Ù…Ø±ÙƒØ¨" }
    ]
  },
  {
    id: "p2",
    title: "Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©",
    subtitle: "ÙØ±Ù‘Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ØŒ Ø§Ù„ØªØµØ§Ø¯Ù…Ø§ØªØŒ ÙˆØ·Ø§Ù‚Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ·",
    pairs: [
      { right: "Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙØ§Ø¹Ù„", left: "ØªØºÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ù…Ø¹ Ø§Ù„Ø²Ù…Ù†" },
      { right: "Ù†Ø¸Ø±ÙŠØ© Ø§Ù„ØªØµØ§Ø¯Ù…", left: "Ø§Ù„ØªÙØ§Ø¹Ù„ ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯ ØªØµØ§Ø¯Ù… ÙØ¹Ù‘Ø§Ù„" },
      { right: "ØªØµØ§Ø¯Ù… ÙØ¹Ù‘Ø§Ù„", left: "Ø·Ø§Ù‚Ø© ÙƒØ§ÙÙŠØ© + Ø§ØªØ¬Ø§Ù‡ Ù…Ù†Ø§Ø³Ø¨" },
      { right: "Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ· (Ea)", left: "Ø£Ù‚Ù„ Ø·Ø§Ù‚Ø© Ù„Ø§Ø²Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙØ§Ø¹Ù„" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", left: "ØªØ²ÙŠØ¯ Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø© (Ø·Ø§Ù‚Ø© Ø£Ø¹Ù„Ù‰)" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ±ÙƒÙŠØ²", left: "ØªØ²ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ø·Ø­", left: "Ø³Ø·Ø­ ØªÙ„Ø§Ù…Ø³ Ø£ÙƒØ¨Ø± â†’ ØªØµØ§Ø¯Ù…Ø§Øª Ø£ÙƒØ«Ø±" },
      { right: "Ø§Ù„Ù…Ø­ÙØ²", left: "ÙŠØ®ÙØ¶ Ea Ø¨Ù…Ø³Ø§Ø± Ø¨Ø¯ÙŠÙ„" },
      { right: "Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø³Ø±Ø¹Ø©", left: "Ø¹Ù„Ø§Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„ØªØ±Ø§ÙƒÙŠØ²" },
      { right: "Ø±ØªØ¨Ø© Ø§Ù„ØªÙØ§Ø¹Ù„", left: "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø³Ø³ ÙÙŠ Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø³Ø±Ø¹Ø©" },
      { right: "Ø«Ø§Ø¨Øª Ø§Ù„Ø³Ø±Ø¹Ø© (k)", left: "ÙŠØªØºÙŠØ± Ø¨ØªØºÙŠØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©" },
      { right: "Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù…Ø­Ø¯ÙÙ‘Ø¯Ø© Ù„Ù„Ø³Ø±Ø¹Ø©", left: "Ø£Ø¨Ø·Ø£ Ø®Ø·ÙˆØ© ØªØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³Ø±Ø¹Ø©" }
    ]
  },
  {
    id: "p3",
    title: "Ø§Ù„Ø§ØªØ²Ø§Ù† Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ",
    subtitle: "ÙØ±Ù‘Ù‚ Ø¨ÙŠÙ† K Ùˆ Q ÙˆØªØ£Ø«ÙŠØ± Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø§ØªØ²Ø§Ù†",
    pairs: [
      { right: "Ø§ØªØ²Ø§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ", left: "Ø³Ø±Ø¹Ø© Ø£Ù…Ø§Ù…ÙŠØ© = Ø³Ø±Ø¹Ø© Ø¹ÙƒØ³ÙŠØ©" },
      { right: "Ø«Ø§Ø¨Øª Ø§Ù„Ø§ØªØ²Ø§Ù† (K)", left: "ÙŠÙ‚ÙŠØ³ Ù…ÙŠÙ„ Ø§Ù„Ø§ØªØ²Ø§Ù† Ø¹Ù†Ø¯ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ù…Ø¹ÙŠÙ†Ø©" },
      { right: "Ø­Ø§ØµÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ (Q)", left: "ÙŠÙ‚ÙŠØ³ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‚Ø¨Ù„/Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØ²Ø§Ù†" },
      { right: "Q < K", left: "ÙŠØªØ¬Ù‡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ØªÙƒÙˆÙŠÙ† Ù†ÙˆØ§ØªØ¬ Ø£ÙƒØ«Ø±" },
      { right: "Q > K", left: "ÙŠØªØ¬Ù‡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ØªÙƒÙˆÙŠÙ† Ù…ØªÙØ§Ø¹Ù„Ø§Øª Ø£ÙƒØ«Ø±" },
      { right: "Ù„Ø§ ØªØ¯Ø®Ù„ ÙÙŠ K", left: "Ø§Ù„ØµÙ„Ø¨ ÙˆØ§Ù„Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ù‚ÙŠ" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ù…ØªÙØ§Ø¹Ù„", left: "Ø§Ù†Ø²ÙŠØ§Ø­ Ù†Ø­Ùˆ Ø§Ù„Ù†ÙˆØ§ØªØ¬" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ù†Ø§ØªØ¬", left: "Ø§Ù†Ø²ÙŠØ§Ø­ Ù†Ø­Ùˆ Ø§Ù„Ù…ØªÙØ§Ø¹Ù„Ø§Øª" },
      { right: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¶ØºØ· (ØºØ§Ø²Ø§Øª)", left: "Ø¬Ù‡Ø© Ù…ÙˆÙ„Ø§Øª Ø§Ù„ØºØ§Ø² Ø§Ù„Ø£Ù‚Ù„" },
      { right: "Ø§Ù„Ù…Ø­ÙØ² ÙÙŠ Ø§Ù„Ø§ØªØ²Ø§Ù†", left: "ÙŠØ³Ø±Ù‘Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ ÙÙ‚Ø· (Ù„Ø§ ÙŠØºÙŠØ± K)" },
      { right: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙÙŠ ØªÙØ§Ø¹Ù„ Ù…Ø§Øµ", left: "Ø±ÙØ¹ Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙŠÙ…ÙŠÙ„ Ù„Ù„Ù†ÙˆØ§ØªØ¬ ÙˆÙŠØºÙŠÙ‘Ø± K" },
      { right: "Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙÙŠ ØªÙØ§Ø¹Ù„ Ø·Ø§Ø±Ø¯", left: "Ø±ÙØ¹ Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙŠÙ…ÙŠÙ„ Ù„Ù„Ù…ØªÙØ§Ø¹Ù„Ø§Øª ÙˆÙŠØºÙŠÙ‘Ø± K" }
    ]
  },
  {
    id: "p4",
    title: "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©",
    subtitle: "ÙØ±Ù‘Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆÙƒØ±Ø¨ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",
    pairs: [
      { right: "Ù‡ÙŠØ¯Ø±ÙˆÙƒØ±Ø¨ÙˆÙ†", left: "ÙŠØªÙƒÙˆÙ† Ù…Ù† C Ùˆ H ÙÙ‚Ø·" },
      { right: "Ø£Ù„ÙƒØ§Ù†", left: "Ù…Ø´Ø¨Ø¹ (Ø±ÙˆØ§Ø¨Ø· Ø£Ø­Ø§Ø¯ÙŠØ©)" },
      { right: "Ø£Ù„ÙƒÙŠÙ†", left: "ØºÙŠØ± Ù…Ø´Ø¨Ø¹ (Ø±Ø§Ø¨Ø·Ø© Ù…Ø²Ø¯ÙˆØ¬Ø©)" },
      { right: "Ø£Ù„ÙƒØ§ÙŠÙ†", left: "ØºÙŠØ± Ù…Ø´Ø¨Ø¹ (Ø±Ø§Ø¨Ø·Ø© Ø«Ù„Ø§Ø«ÙŠØ©)" },
      { right: "Ø£Ø±ÙˆÙ…Ø§ØªÙŠ", left: "Ø­Ù„Ù‚Ø© Ø¨Ù†Ø²ÙŠÙ†/Ù†Ø¸Ø§Ù… Ø¹Ø·Ø±ÙŠ" },
      { right: "Ø§Ù„Ø¥Ø¶Ø§ÙØ©", left: "ØªÙØ§Ø¹Ù„ Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©" },
      { right: "Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„", left: "ØªÙØ§Ø¹Ù„ Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø£Ù„ÙƒØ§Ù†Ø§Øª/Ø§Ù„Ø£Ø±ÙˆÙ…Ø§ØªÙŠØ§Øª Ø¨Ø´Ø±ÙˆØ·" },
      { right: "Ø§Ù„Ø¨Ù„Ù…Ø±Ø©", left: "ØªØ­ÙˆÙŠÙ„ Ù…ÙˆÙ†ÙˆÙ…Ø±Ø§Øª Ø¥Ù„Ù‰ Ø¨ÙˆÙ„ÙŠÙ…Ø±" },
      { right: "Ù‡Ø§Ù„ÙŠØ¯ Ø£Ù„ÙƒÙŠÙ„ (Râ€“X)", left: "Ù…Ø´ØªÙ‚ Ø¹Ø¶ÙˆÙŠ ÙŠØ­ØªÙˆÙŠ Ù‡Ø§Ù„ÙˆØ¬ÙŠÙ†" },
      { right: "Ù…Ø¬Ù…ÙˆØ¹Ø© -OH", left: "ÙƒØ­ÙˆÙ„" },
      { right: "Ù…Ø¬Ù…ÙˆØ¹Ø© -COOH", left: "Ø­Ù…Ø¶ ÙƒØ±Ø¨ÙˆÙƒØ³ÙŠÙ„ÙŠ" },
      { right: "Ø§Ù„Ø£Ø­Ù…Ø§Ø¶ Ø§Ù„Ø£Ù…ÙŠÙ†ÙŠØ©", left: "ÙˆØ­Ø¯Ø§Øª Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†Ø§Øª" }
    ]
  }
];

/* =========================
   Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
   ========================= */
const state = {
  pageIndex: 0,
  score: Number(localStorage.getItem("chem_score") || 0),
  streak: Number(localStorage.getItem("chem_streak") || 0),
  sound: true,
  selectedRightKey: null,
  selectedLeftKey: null,
  matchedByPage: new Map(),
  timerByPage: new Map(),
  lastShownCompletion: new Set(),
  _grandShown: false
};

const TIMER_SECONDS = 75; // Ø¹Ø¯Ù‘Ù„ÙŠ 60/75/90 Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ

const el = (id)=>document.getElementById(id);

function save(){
  localStorage.setItem("chem_score", String(state.score));
  localStorage.setItem("chem_streak", String(state.streak));
}
function updateHeader(){
  el("score").textContent = state.score;
  el("streak").textContent = state.streak;
}
updateHeader();

/* =========================
   Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‡ÙˆÙŠØ© (Ù…Ø¯Ø±Ø³Ø©/Ù…Ø¹Ù„Ù…Ø©/Ù…Ø¯ÙŠØ±Ø©)
   ========================= */
const schoolInput = el("schoolName");
const teacherInput = el("teacherName");
const principalInput = el("principalName");

schoolInput.value = localStorage.getItem("chem_school") || "";
teacherInput.value = localStorage.getItem("chem_teacher") || "";
principalInput.value = localStorage.getItem("chem_principal") || "";

schoolInput.addEventListener("input", ()=> localStorage.setItem("chem_school", schoolInput.value.trim()));
teacherInput.addEventListener("input", ()=> localStorage.setItem("chem_teacher", teacherInput.value.trim()));
principalInput.addEventListener("input", ()=> localStorage.setItem("chem_principal", principalInput.value.trim()));

/* =========================
   ØªØ´Ø¬ÙŠØ¹ Ù…ØªÙ†ÙˆØ¹
   ========================= */
const PRAISE = [
  "Ù…Ù…ØªØ§Ø²! ØªØ±ÙƒÙŠØ²Ùƒ ÙˆØ§Ø¶Ø­ âœ…",
  "Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ù‹Ø§! Ø§Ø³ØªÙ…Ø±ÙŠ ğŸŒ¿",
  "Ø¥Ø¬Ø§Ø¨Ø© Ø¯Ù‚ÙŠÙ‚Ø©! ğŸ‘Œ",
  "Ø¥ØªÙ‚Ø§Ù† Ø¬Ù…ÙŠÙ„! âœ¨",
  "Ø³Ø±ÙŠØ¹Ø© ÙˆØ°ÙƒÙŠØ©! ğŸ”¥",
  "Ø£Ø­Ø³Ù†ØªÙ! ğŸ‘",
  "Ø´ØºÙ„ Ø¹Ù„Ù…ÙŠ Ù…Ø±ØªØ¨ ğŸ§ ",
  "Ù…Ù…ØªØ§Ø²Ø©! Ø®Ø·ÙˆØ© Ù„Ù„Ø£Ù…Ø§Ù… â­"
];
const TRY_AGAIN = [
  "Ù‚Ø±ÙŠØ¨Ø©! Ø¬Ø±Ù‘Ø¨ÙŠ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ğŸŒ¼",
  "ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ùƒâ€”Ø±Ø§Ø¬Ø¹ÙŠ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø¨Ø³Ø±Ø¹Ø© ğŸ§ ",
  "Ø­Ù„Ùˆ! Ø§Ù„Ø¢Ù† Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¯Ù‚ âœ¨",
  "Ù…Ùˆ Ù…Ø´ÙƒÙ„Ø©â€”Ø§Ø±Ø¬Ø¹ÙŠ Ù„Ù„ØªÙ„Ù…ÙŠØ­ ğŸ‘‡",
  "ØªÙ…Ø§Ù…â€¦ Ù…ÙÙ‡ÙˆÙ… â†’ ØªØ¹Ø±ÙŠÙ âœ…"
];
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* =========================
   Toast
   ========================= */
let toastTimer = null;
function showToast(msg){
  const t = el("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>t.classList.remove("show"), 1800);
}

/* =========================
   Reward Overlay + Sparkles
   ========================= */
function renderSparkles(){
  const host = el("sparkles");
  if(!host) return;
  host.innerHTML = "";
  for(let i=0;i<12;i++){
    const s = document.createElement("i");
    s.style.top = `${8 + Math.random()*84}%`;
    s.style.left = `${6 + Math.random()*88}%`;
    s.style.animationDelay = `${Math.random()*1.6}s`;
    s.style.width = `${6 + Math.random()*10}px`;
    s.style.height = s.style.width;
    host.appendChild(s);
  }
}
function showReward({icon="ğŸ‘‘", title="Ù…Ù…ØªØ§Ø²Ø©!", text=""}={}){
  el("rewardIcon").textContent = icon;
  el("rewardTitle").textContent = title;
  el("rewardText").innerHTML = text;
  renderSparkles();
  el("rewardOverlay").classList.add("show");
}
function hideReward(){ el("rewardOverlay").classList.remove("show"); }

el("rewardClose").addEventListener("click", hideReward);
el("rewardOverlay").addEventListener("click", (e)=>{
  if(e.target.id === "rewardOverlay") hideReward();
});

/* =========================
   Ø£ØµÙˆØ§Øª WebAudio (Ø¨Ø¯ÙˆÙ† Ù…Ù„ÙØ§Øª)
   ========================= */
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
function beep({freq=660, dur=0.09, type="sine", gain=0.06}={}){
  if(!state.sound) return;
  ensureAudio();
  const t0 = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.setValueAtTime(freq, t0);
  g.gain.setValueAtTime(gain, t0);
  g.gain.exponentialRampToValueAtTime(0.001, t0 + dur);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(t0); o.stop(t0 + dur);
}
function applause(){
  if(!state.sound) return;
  ensureAudio();
  for(let i=0;i<14;i++){
    setTimeout(()=>beep({freq: 380+Math.random()*520, dur:0.04, type:"square", gain:0.03}), i*45);
  }
}
function fireworkPop(){
  if(!state.sound) return;
  beep({freq: 920, dur:0.05, type:"triangle", gain:0.05});
  setTimeout(()=>beep({freq: 240, dur:0.12, type:"sawtooth", gain:0.03}), 65);
}
function wrongBuzz(){
  if(!state.sound) return;
  beep({freq: 210, dur:0.12, type:"sawtooth", gain:0.06});
  setTimeout(()=>beep({freq: 170, dur:0.10, type:"sawtooth", gain:0.05}), 120);
}
function successChime(){
  if(!state.sound) return;
  beep({freq: 880, dur:0.07, type:"sine", gain:0.05});
  setTimeout(()=>beep({freq: 1046, dur:0.08, type:"triangle", gain:0.05}), 90);
  setTimeout(()=>beep({freq: 1318, dur:0.10, type:"sine", gain:0.05}), 190);
}

/* =========================
   Confetti (Ø§Ø­ØªÙØ§Ù„)
   ========================= */
function celebrate(){
  const base = { origin:{y:0.75}, ticks:260, spread:90 };
  confetti({ ...base, particleCount: 120, scalar: 1.05 });
  setTimeout(()=>confetti({ ...base, particleCount: 80, spread:70, origin:{y:0.78}, scalar: 0.95 }), 160);
  setTimeout(()=>confetti({ ...base, particleCount: 70, spread:110, origin:{y:0.70}, scalar: 1.10 }), 320);
  fireworkPop();
  applause();
}

/* =========================
   Timer Ù„ÙƒÙ„ ÙØµÙ„
   ========================= */
function ensureTimer(pageId){
  if(!state.timerByPage.has(pageId)){
    state.timerByPage.set(pageId, { remaining: TIMER_SECONDS, intervalId: null, running:false });
  }
  return state.timerByPage.get(pageId);
}
function formatTime(s){
  const m = Math.floor(s/60);
  const r = s%60;
  return `${m}:${String(r).padStart(2,"0")}`;
}
function updateTimerUI(pageId){
  const t = ensureTimer(pageId);
  const pill = document.getElementById(`${pageId}_timer`);
  if(!pill) return;
  pill.innerHTML = `â± Ø§Ù„ÙˆÙ‚Øª: <b>${formatTime(t.remaining)}</b>`;
  pill.classList.remove("danger","ok");
  if(t.remaining <= 15) pill.classList.add("danger");
  else pill.classList.add("ok");
}
function startTimer(pageId){
  const t = ensureTimer(pageId);
  if(t.running) return;
  t.running = true;
  t.intervalId = setInterval(()=>{
    if(t.remaining > 0){
      t.remaining -= 1;
      updateTimerUI(pageId);
    }else{
      stopTimer(pageId);
      state.streak = 0;
      save(); updateHeader();
      showToast("â± Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø£Ø¹ÙŠØ¯ÙŠ Ø®Ù„Ø· Ø§Ù„ÙØµÙ„ Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ÙŠ Ù…Ù† Ø¬Ø¯ÙŠØ¯.");
      wrongBuzz();
    }
  }, 1000);
}
function stopTimer(pageId){
  const t = ensureTimer(pageId);
  if(t.intervalId) clearInterval(t.intervalId);
  t.intervalId = null;
  t.running = false;
}
function resetTimer(pageId){
  stopTimer(pageId);
  const t = ensureTimer(pageId);
  t.remaining = TIMER_SECONDS;
  updateTimerUI(pageId);
}
function timeBonus(pageId){
  const t = ensureTimer(pageId);
  return Math.max(0, Math.min(10, Math.floor(t.remaining / 8)));
}

/* =========================
   Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹
   ========================= */
const pagesHost = el("pagesHost");

function keyFor(side, idx){ return `${side}:${idx}`; }

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function ensureMatchedSet(pageId){
  if(!state.matchedByPage.has(pageId)) state.matchedByPage.set(pageId, new Set());
  return state.matchedByPage.get(pageId);
}

function renderAllPages(){
  pagesHost.innerHTML = "";
  PAGES.forEach((p, idx)=>{
    const section = document.createElement("section");
    section.className = "pages";
    section.id = p.id;

    const rights = shuffle(p.pairs.map(x=>x.right));
    const lefts  = shuffle(p.pairs.map(x=>x.left));
    section.dataset.rights = JSON.stringify(rights);
    section.dataset.lefts  = JSON.stringify(lefts);

    section.innerHTML = `
      <div class="intro">
        <div>
          <h2>${p.title}</h2>
          <small>${p.subtitle}</small>
        </div>
        <div class="progress">
          <span id="${p.id}_ptext">0/${p.pairs.length}</span>
          <div class="bar"><i id="${p.id}_pbar"></i></div>
          <div class="timerPill" id="${p.id}_timer">â± Ø§Ù„ÙˆÙ‚Øª: <b>${formatTime(TIMER_SECONDS)}</b></div>
          <button class="ghost" id="${p.id}_restart">Ø¥Ø¹Ø§Ø¯Ø© Ø®Ù„Ø·</button>
        </div>
      </div>

      <div class="board">
        <div class="col">
          <h3>Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª <span>Ø§Ø¶ØºØ·ÙŠ ØªØ¹Ø±ÙŠÙÙ‹Ø§ (ÙŠØ³Ø§Ø±)</span></h3>
          <div class="list" id="${p.id}_left"></div>
        </div>
        <div class="col">
          <h3>Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… <span>Ø§Ø¶ØºØ·ÙŠ Ù…ÙÙ‡ÙˆÙ…Ù‹Ø§ (ÙŠÙ…ÙŠÙ†)</span></h3>
          <div class="list" id="${p.id}_right"></div>
        </div>
      </div>

      <div class="hint" id="${p.id}_hint">Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù…ÙÙ‡ÙˆÙ… Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø«Ù… Ø§Ø®ØªØ§Ø±ÙŠ ØªØ¹Ø±ÙŠÙÙ‡ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±.</div>
      <div class="footerRow">
        <div class="chips">
          <div class="chip">Tap-to-Match</div>
          <div class="chip">ÙØ±Ù‘Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…</div>
          <div class="chip">ØµÙØ­Ø© ${idx+1} Ù…Ù† 4</div>
        </div>
      </div>
    `;

    pagesHost.appendChild(section);

    section.querySelector(`#${p.id}_restart`).addEventListener("click", ()=>{
      state.matchedByPage.set(p.id, new Set());
      state.lastShownCompletion.delete(p.id);
      state._grandShown = false;

      section.dataset.rights = JSON.stringify(shuffle(p.pairs.map(x=>x.right)));
      section.dataset.lefts  = JSON.stringify(shuffle(p.pairs.map(x=>x.left)));
      state.selectedRightKey = null;
      state.selectedLeftKey = null;

      resetTimer(p.id);
      startTimer(p.id);

      renderPage(p.id);
      showToast("ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ù„Ø·! Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø³Ø±Ø¹Ø© Ù„Ø¬Ù…Ø¹ Ø¨ÙˆÙ†Øµ Ø§Ù„ÙˆÙ‚Øª.");
      beep({freq: 520, dur:0.07, type:"sine", gain:0.05});
    });

    renderPage(p.id);
  });
}

function renderPage(pageId){
  const page = PAGES.find(x=>x.id===pageId);
  const section = document.getElementById(pageId);
  const matched = ensureMatchedSet(pageId);

  const rights = JSON.parse(section.dataset.rights);
  const lefts  = JSON.parse(section.dataset.lefts);

  const leftHost = section.querySelector(`#${pageId}_left`);
  const rightHost = section.querySelector(`#${pageId}_right`);
  const hint = section.querySelector(`#${pageId}_hint`);

  leftHost.innerHTML = "";
  rightHost.innerHTML = "";

  lefts.forEach((txt, idx)=>{
    const k = keyFor("L", idx);
    const div = document.createElement("div");
    div.className = "item";
    div.dataset.key = k;

    if(matched.has(k)){
      div.classList.add("matched");
      div.innerHTML = `<span>${txt}</span><small>âœ” ØªÙ…</small>`;
    }else{
      div.innerHTML = `<span>${txt}</span><small>Ø§Ø®ØªÙŠØ§Ø±</small>`;
      div.addEventListener("click", ()=> onPick(pageId, "L", idx));
    }
    leftHost.appendChild(div);
  });

  rights.forEach((txt, idx)=>{
    const k = keyFor("R", idx);
    const div = document.createElement("div");
    div.className = "item";
    div.dataset.key = k;

    if(matched.has(k)){
      div.classList.add("matched");
      div.innerHTML = `<span>${txt}</span><small>âœ” ØªÙ…</small>`;
    }else{
      div.innerHTML = `<span>${txt}</span><small>Ø§Ø®ØªÙŠØ§Ø±</small>`;
      div.addEventListener("click", ()=> onPick(pageId, "R", idx));
    }
    rightHost.appendChild(div);
  });

  // Ø§Ù„ØªÙ‚Ø¯Ù…
  const pairsCount = page.pairs.length;
  const matchedPairs = Math.floor(matched.size / 2);
  section.querySelector(`#${pageId}_ptext`).textContent = `${matchedPairs}/${pairsCount}`;
  section.querySelector(`#${pageId}_pbar`).style.width = `${Math.round((matchedPairs/pairsCount)*100)}%`;
  updateTimerUI(pageId);

  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
  if(state.selectedLeftKey){
    const n = section.querySelector(`[data-key="${state.selectedLeftKey}"]`);
    if(n && !n.classList.contains("matched")) n.classList.add("selected");
  }
  if(state.selectedRightKey){
    const n = section.querySelector(`[data-key="${state.selectedRightKey}"]`);
    if(n && !n.classList.contains("matched")) n.classList.add("selected");
  }

  if(matchedPairs === pairsCount){
    hint.textContent = "ğŸ‰ Ø£Ù†Ù‡ÙŠØªÙ Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙØµÙ„ Ø§Ù„ØªØ§Ù„ÙŠ.";
    stopTimer(pageId);

    // Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙØµÙ„ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)
    if(!state.lastShownCompletion.has(pageId)){
      state.lastShownCompletion.add(pageId);

      const t = ensureTimer(pageId);
      let icon="ğŸ–ï¸", title="Ù…ÙŠØ¯Ø§Ù„ÙŠØ© Ø¥Ù†Ø¬Ø§Ø²!", msgExtra="";
      if(t.remaining >= 45){ icon="ğŸ‘‘"; title="ØªØ§Ø¬ Ø§Ù„ØªÙØ±ÙŠÙ‚!"; msgExtra="Ø³Ø±Ø¹ØªÙƒ Ù…Ù…ØªØ§Ø²Ø©!"; }
      else if(t.remaining >= 25){ icon="ğŸ…"; title="ÙˆØ³Ø§Ù… Ù…Ù…ØªØ§Ø²!"; msgExtra="Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!"; }
      else { icon="ğŸ–ï¸"; title="Ù…ÙŠØ¯Ø§Ù„ÙŠØ© Ø¥Ù†Ø¬Ø§Ø²!"; msgExtra="Ø§Ø³ØªÙ…Ø±Ù‘ÙŠ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰!"; }

      const school = localStorage.getItem("chem_school") || "Ù…Ø¯Ø±Ø³ØªÙƒ";
      const teacher = localStorage.getItem("chem_teacher") || "Ø§Ù„Ù…Ø¹Ù„Ù…Ø©";
      const principal = localStorage.getItem("chem_principal") || "Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©";

      showReward({
        icon,
        title,
        text: `
          <div style="line-height:1.9;">
            Ø¥Ù†Ø¬Ø§Ø² Ø¬Ù…ÙŠÙ„ ÙÙŠ <b>${school}</b> âœ¨<br>
            Ø¨Ø¥Ø´Ø±Ø§Ù <b>${teacher}</b> ğŸŒ¿<br>
            ÙˆØ¨Ø¯Ø¹Ù… <b>${principal}</b> ğŸ«<br>
            Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${formatTime(t.remaining)}</b> â€” ${msgExtra}
          </div>
        `
      });
      successChime();
      confetti({particleCount:180, spread:95, origin:{y:0.72}, ticks:280, scalar:1.05});
    }

    // ÙƒØ£Ø³ Ù†Ù‡Ø§Ø¦ÙŠ Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„Øª ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„
    if(allChaptersCompleted() && !state._grandShown){
      state._grandShown = true;
      setTimeout(showGrandTrophy, 350);
    }
  }else{
    hint.textContent = "Ø§Ø®ØªØ§Ø±ÙŠ Ù…ÙÙ‡ÙˆÙ…Ù‹Ø§ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø«Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±.";
  }
}

function findPairIndexByText(page, rightText, leftText){
  return page.pairs.findIndex(p => p.right === rightText && p.left === leftText);
}

function onPick(pageId, side, idx){
  const section = document.getElementById(pageId);
  const page = PAGES.find(x=>x.id===pageId);
  const matched = ensureMatchedSet(pageId);

  const key = keyFor(side, idx);
  if(matched.has(key)) return;

  // Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„ ÙŠØ¨Ø¯Ø£ Ø§Ù„ØµÙˆØª/Ø§Ù„Ù…Ø¤Ù‚Øª
  startTimer(pageId);

  if(side === "R") state.selectedRightKey = key;
  if(side === "L") state.selectedLeftKey  = key;

  beep({freq: side==="R" ? 740 : 620, dur:0.05, type:"sine", gain:0.04});
  renderPage(pageId);

  if(state.selectedRightKey && state.selectedLeftKey){
    const rights = JSON.parse(section.dataset.rights);
    const lefts  = JSON.parse(section.dataset.lefts);

    const rIdx = Number(state.selectedRightKey.split(":")[1]);
    const lIdx = Number(state.selectedLeftKey.split(":")[1]);

    const rightText = rights[rIdx];
    const leftText  = lefts[lIdx];

    const isCorrect = findPairIndexByText(page, rightText, leftText) !== -1;

    const rNode = section.querySelector(`[data-key="${state.selectedRightKey}"]`);
    const lNode = section.querySelector(`[data-key="${state.selectedLeftKey}"]`);

    if(isCorrect){
      matched.add(state.selectedRightKey);
      matched.add(state.selectedLeftKey);

      const bonus = timeBonus(pageId);
      state.score += (10 + bonus);
      state.streak += 1;
      save(); updateHeader();

      showToast(`${pick(PRAISE)} (+${bonus} Ø¨ÙˆÙ†Øµ ÙˆÙ‚Øª)`);
      celebrate();

      state.selectedRightKey = null;
      state.selectedLeftKey = null;
      renderPage(pageId);
    }else{
      state.streak = 0;
      save(); updateHeader();

      wrongBuzz();
      showToast(pick(TRY_AGAIN));

      if(rNode) rNode.classList.add("wrong");
      if(lNode) lNode.classList.add("wrong");

      setTimeout(()=>{
        state.selectedRightKey = null;
        state.selectedLeftKey = null;
        renderPage(pageId);
      }, 550);
    }
  }
}

/* =========================
   ØªÙ†Ù‚Ù„ Ø§Ù„ØµÙØ­Ø§Øª
   ========================= */
function setActivePage(idx){
  state.pageIndex = Math.max(0, Math.min(PAGES.length-1, idx));
  const all = [...document.querySelectorAll(".pages")];
  all.forEach(s => s.classList.remove("active"));
  const activeId = PAGES[state.pageIndex].id;
  document.getElementById(activeId).classList.add("active");
  el("pageCrumb").textContent = `Ø§Ù„ÙØµÙ„ ${state.pageIndex+1}/4 â€” ${PAGES[state.pageIndex].title}`;

  resetTimer(activeId);
  startTimer(activeId);

  beep({freq: 640, dur:0.05, type:"sine", gain:0.04});
}

el("prevPage").addEventListener("click", ()=> setActivePage(state.pageIndex - 1));
el("nextPage").addEventListener("click", ()=> setActivePage(state.pageIndex + 1));

el("rewardNext").addEventListener("click", ()=>{
  hideReward();
  setActivePage(state.pageIndex + 1);
});

/* =========================
   ÙƒØ£Ø³ Ù†Ù‡Ø§Ø¦ÙŠ
   ========================= */
function allChaptersCompleted(){
  return PAGES.every(p=>{
    const set = state.matchedByPage.get(p.id);
    return set && (Math.floor(set.size/2) === p.pairs.length);
  });
}
function showGrandTrophy(){
  const school = localStorage.getItem("chem_school") || "Ù…Ø¯Ø±Ø³ØªÙƒ";
  const teacher = localStorage.getItem("chem_teacher") || "Ø§Ù„Ù…Ø¹Ù„Ù…Ø©";
  const principal = localStorage.getItem("chem_principal") || "Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©";

  confetti({ particleCount: 260, spread: 120, origin: { y: 0.70 }, ticks: 320, scalar: 1.1 });
  setTimeout(()=>confetti({ particleCount: 180, spread: 100, origin: { y: 0.75 }, ticks: 320, scalar: 1.05 }), 220);
  setTimeout(()=>confetti({ particleCount: 140, spread: 140, origin: { y: 0.60 }, ticks: 360, scalar: 1.15 }), 520);

  successChime();
  applause();

  showReward({
    icon:"ğŸ†",
    title:"Ø§Ù„ÙƒØ£Ø³ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ â€” Ø£ØªÙ…Ù…ØªÙ Ø§Ù„Ù…Ù†ØµÙ‘Ø©!",
    text: `
      <div style="margin-top:6px; line-height:1.9; font-weight:950; color:#6b7280">
        <div style="font-size:15px; margin-bottom:6px;">
          ğŸ“ <b style="color:#1f2a37">${school}</b>
        </div>
        Ø¥Ù†Ø¬Ø§Ø² Ø±Ø§Ø¦Ø¹ Ø¨Ø¥Ø´Ø±Ø§Ù <b style="color:#1f2a37">${teacher}</b> ğŸŒ¿
        ÙˆØ¨Ø¯Ø¹Ù… <b style="color:#1f2a37">${principal}</b> ğŸ«
        <br>
        Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø·Ùƒ: <b style="color:#33618C">${state.score}</b> â­
      </div>
      <div class="trophyRibbon">
        <span class="tag">ğŸ‘‘ ØªÙØ±ÙŠÙ‚</span>
        <span class="tag">â± Ø³Ø±Ø¹Ø©</span>
        <span class="tag">âœ¨ Ø¥ØªÙ‚Ø§Ù†</span>
        <span class="tag">ğŸ… Ø¥Ù†Ø¬Ø§Ø²</span>
      </div>
    `
  });
}

/* =========================
   Ø£Ø²Ø±Ø§Ø± Ø¹Ø§Ù…Ø©
   ========================= */
el("toggleSound").addEventListener("click", (e)=>{
  state.sound = !state.sound;
  e.target.textContent = state.sound ? "ğŸ”Š Ø§Ù„ØµÙˆØª: ØªØ´ØºÙŠÙ„" : "ğŸ”‡ Ø§Ù„ØµÙˆØª: Ø¥ÙŠÙ‚Ø§Ù";
  beep({freq: state.sound ? 820 : 240, dur:0.07, type:"sine", gain:0.05});
});

el("resetAll").addEventListener("click", ()=>{
  state.score = 0;
  state.streak = 0;
  save(); updateHeader();

  state.lastShownCompletion = new Set();
  state._grandShown = false;

  PAGES.forEach(p=>{
    state.matchedByPage.set(p.id, new Set());
    resetTimer(p.id);
  });

  state.selectedRightKey = null;
  state.selectedLeftKey = null;

  renderPage(PAGES[state.pageIndex].id);
  showToast("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø· âœ…");
  beep({freq: 300, dur:0.09, type:"triangle", gain:0.05});
});

el("rewardRestart").addEventListener("click", ()=>{
  hideReward();

  state.score = 0;
  state.streak = 0;
  save(); updateHeader();

  state.lastShownCompletion = new Set();
  state._grandShown = false;

  PAGES.forEach(p=>{
    state.matchedByPage.set(p.id, new Set());
    resetTimer(p.id);
  });

  state.selectedRightKey = null;
  state.selectedLeftKey = null;

  setActivePage(0);
  renderPage(PAGES[0].id);

  showToast("âœ¨ Ø¨Ø¯Ø£Ù†Ø§ Ù…Ù† Ø¬Ø¯ÙŠØ¯! Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚");
});

/* =========================
   ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
   ========================= */
renderAllPages();
setActivePage(0);
</script>
</body>
</html>
